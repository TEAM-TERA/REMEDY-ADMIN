services:
  remedy-admin-app:
    build: .
    container_name: remedy-admin-app
    env_file:
      - .env
    environment:
      - AI_API_KEY=${AI_API_KEY}
      - AI_TEMPERATURE=${AI_TEMPERATURE}
      - AI_MODEL=${AI_MODEL}
      - AI_BASE_URL=${AI_BASE_URL}
      - AI_COMPLETIONS_PATH=${AI_COMPLETIONS_PATH}
      - TRINO_URL=${TRINO_URL}
    ports:
      - "8080:8080"
    networks:
      - remedy-admin-network

  trino:
    image: trinodb/trino:478
    container_name: trino
    volumes:
      - ./trino/etc:/etc/trino
      - ./trino/data:/data
      - ./trino/logs:/var/log/trino
    environment:
      - JAVA_TOOL_OPTIONS=-Xmx2g
    networks:
      - remedy-admin-network

  remedy-admin-prometheus:
    image: prom/prometheus:latest
    container_name: remedy-admin-prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - prometheus_data:/prometheus
    ports:
      - "9090:9090"
    networks:
      - remedy-admin-network
      - remedy-network

  remedy-admin-grafana:
    image: grafana/grafana:latest
    container_name: remedy-admin-grafana
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_ADMIN_PASSWORD}
    ports:
      - "3000:3000"
    networks:
      - remedy-admin-network
      - remedy-prometheus-network
    depends_on:
      - remedy-admin-network
      - remedy-network
    volumes:
      - grafana_data:/var/lib/grafana

networks:
  remedy-admin-network:
    driver: bridge
  remedy-network:
    driver: bridge

volumes:
  grafana_data:
    driver: local
  prometheus_data:
    driver: local